<html>
<head><script src="//archive.org/includes/analytics.js?v=cf34f82" type="text/javascript"></script>
<script type="text/javascript">window.addEventListener('DOMContentLoaded',function(){var v=archive_analytics.values;v.service='wb';v.server_name='wwwb-app204.us.archive.org';v.server_ms=686;archive_analytics.send_pageview({});});</script><script type="text/javascript" src="/_static/js/playback.bundle.js?v=SOX25l-I" charset="utf-8"></script>
<script type="text/javascript" src="/_static/js/wombat.js?v=cRqOKCOw" charset="utf-8"></script>
<script type="text/javascript">
  __wm.init("http://web.archive.org/web");
  __wm.wombat("http://jonathan.tang.name:80/files/scheme_in_48/tutorial/repl.html","20131231023955","http://web.archive.org/","web","/_static/",
	      "1388457595");
</script>
<link rel="stylesheet" type="text/css" href="/_static/css/banner-styles.css?v=bsmaklHF" />
<link rel="stylesheet" type="text/css" href="/_static/css/iconochive.css?v=qtvMKcIJ" />
<!-- End Wayback Rewrite JS Include -->

<title>Write Yourself a Scheme in 48 hours</title>
<link rel="stylesheet" href="/web/20131231023955cs_/http://jonathan.tang.name/files/scheme_in_48/tutorial/styles.css"/>
</head>
<body><!-- BEGIN WAYBACK TOOLBAR INSERT -->
<style type="text/css">
body {
  margin-top:0 !important;
  padding-top:0 !important;
  /*min-width:800px !important;*/
}
</style>
<script>__wm.rw(0);</script>
<div id="wm-ipp-base" lang="en" style="display:none;direction:ltr;">
<div id="wm-ipp" style="position:fixed;left:0;top:0;right:0;">
<div id="wm-ipp-inside">
  <div style="position:relative;">
    <div id="wm-logo" style="float:left;width:110px;padding-top:12px;">
      <a href="/web/" title="Wayback Machine home page"><img src="/_static/images/toolbar/wayback-toolbar-logo-200.png" srcset="/_static/images/toolbar/wayback-toolbar-logo-100.png, /_static/images/toolbar/wayback-toolbar-logo-150.png 1.5x, /_static/images/toolbar/wayback-toolbar-logo-200.png 2x" alt="Wayback Machine" style="width:100px" border="0" /></a>
    </div>
    <div class="r" style="float:right;">
      <div id="wm-btns" style="text-align:right;height:25px;">
                  <div id="wm-save-snapshot-success">success</div>
          <div id="wm-save-snapshot-fail">fail</div>
          <a id="wm-save-snapshot-open" href="#"
	     title="Share via My Web Archive" >
            <span class="iconochive-web"></span>
          </a>
          <a href="https://archive.org/account/login.php"
             title="Sign In"
             id="wm-sign-in"
          >
            <span class="iconochive-person"></span>
          </a>
          <span id="wm-save-snapshot-in-progress" class="iconochive-web"></span>
        	<a href="http://faq.web.archive.org/" title="Get some help using the Wayback Machine" style="top:-6px;"><span class="iconochive-question" style="color:rgb(87,186,244);font-size:160%;"></span></a>
	<a id="wm-tb-close" href="#close" onclick="__wm.h(event);return false;" style="top:-2px;" title="Close the toolbar"><span class="iconochive-remove-circle" style="color:#888888;font-size:240%;"></span></a>
      </div>
      <div id="wm-share">
          <a href="/web/20131231023955/http://web.archive.org/screenshot/http://jonathan.tang.name/files/scheme_in_48/tutorial/repl.html"
             id="wm-screenshot"
             title="screenshot">
            <span class="wm-icon-screen-shot"></span>
          </a>
	<a id="wm-share-facebook" href="#" data-url="http://web.archive.org/web/20131231023955/http://jonathan.tang.name:80/files/scheme_in_48/tutorial/repl.html" title="Share on Facebook" style="margin-right:5px;" target="_blank"><span class="iconochive-facebook" style="color:#3b5998;font-size:160%;"></span></a>
	<a id="wm-share-twitter" href="#" data-url="http://web.archive.org/web/20131231023955/http://jonathan.tang.name:80/files/scheme_in_48/tutorial/repl.html" title="Share on Twitter" style="margin-right:5px;" target="_blank"><span class="iconochive-twitter" style="color:#1dcaff;font-size:160%;"></span></a>
      </div>
    </div>
    <table class="c" style="">
      <tbody>
	<tr>
	  <td class="u" colspan="2">
	    <form target="_top" method="get" action="/web/submit" name="wmtb" id="wmtb"><input type="text" name="url" id="wmtbURL" value="http://jonathan.tang.name/files/scheme_in_48/tutorial/repl.html" onfocus="this.focus();this.select();" /><input type="hidden" name="type" value="replay" /><input type="hidden" name="date" value="20131231023955" /><input type="submit" value="Go" /></form>
	  </td>
	  <td class="n" rowspan="2" style="width:110px;">
	    <table>
	      <tbody>
		<!-- NEXT/PREV MONTH NAV AND MONTH INDICATOR -->
		<tr class="m">
		  <td class="b" nowrap="nowrap"><a href="http://web.archive.org/web/20131031084907/http://jonathan.tang.name:80/files/scheme_in_48/tutorial/repl.html" title="31 Oct 2013"><strong>Oct</strong></a></td>
		  <td class="c" id="displayMonthEl" title="You are here: 02:39:55 Dec 31, 2013">DEC</td>
		  <td class="f" nowrap="nowrap">Jan</td>
		</tr>
		<!-- NEXT/PREV CAPTURE NAV AND DAY OF MONTH INDICATOR -->
		<tr class="d">
		  <td class="b" nowrap="nowrap"><a href="http://web.archive.org/web/20131031084907/http://jonathan.tang.name:80/files/scheme_in_48/tutorial/repl.html" title="08:49:07 Oct 31, 2013"><img src="/_static/images/toolbar/wm_tb_prv_on.png" alt="Previous capture" width="14" height="16" border="0" /></a></td>
		  <td class="c" id="displayDayEl" style="width:34px;font-size:24px;white-space:nowrap;" title="You are here: 02:39:55 Dec 31, 2013">31</td>
		  <td class="f" nowrap="nowrap"><img src="/_static/images/toolbar/wm_tb_nxt_off.png" alt="Next capture" width="14" height="16" border="0" /></td>
		</tr>
		<!-- NEXT/PREV YEAR NAV AND YEAR INDICATOR -->
		<tr class="y">
		  <td class="b" nowrap="nowrap"><a href="http://web.archive.org/web/20121122003409/http://jonathan.tang.name:80/files/scheme_in_48/tutorial/repl.html" title="22 Nov 2012"><strong>2012</strong></a></td>
		  <td class="c" id="displayYearEl" title="You are here: 02:39:55 Dec 31, 2013">2013</td>
		  <td class="f" nowrap="nowrap">2014</td>
		</tr>
	      </tbody>
	    </table>
	  </td>
	</tr>
	<tr>
	  <td class="s">
	    	    <div id="wm-nav-captures">
	      	      <a class="t" href="/web/20131231023955*/http://jonathan.tang.name/files/scheme_in_48/tutorial/repl.html" title="See a list of every capture for this URL">13 captures</a>
	      <div class="r" title="Timespan for captures of this URL">05 Sep 2009 - 31 Dec 2013</div>
	      </div>
	  </td>
	  <td class="k">
	    <a href="" id="wm-graph-anchor">
	      <div id="wm-ipp-sparkline" title="Explore captures for this URL" style="position: relative">
		<canvas id="wm-sparkline-canvas" width="650" height="27" border="0"></canvas>
	      </div>
	    </a>
	  </td>
	</tr>
      </tbody>
    </table>
    <div style="position:absolute;bottom:0;right:2px;text-align:right;">
      <a id="wm-expand" class="wm-btn wm-closed" href="#expand" onclick="__wm.ex(event);return false;"><span id="wm-expand-icon" class="iconochive-down-solid"></span> <span style="font-size:80%">About this capture</span></a>
    </div>
  </div>
    <div id="wm-capinfo" style="border-top:1px solid #777;display:none; overflow: hidden">
                    <div id="wm-capinfo-collected-by">
    <div style="background-color:#666;color:#fff;font-weight:bold;text-align:center">COLLECTED BY</div>
    <div style="padding:3px;position:relative" id="wm-collected-by-content">
            <div style="display:inline-block;vertical-align:top;width:50%;">
			<span class="c-logo" style="background-image:url(https://archive.org/services/img/alexacrawls);"></span>
		Organization: <a style="color:#33f;" href="https://archive.org/details/alexacrawls" target="_new"><span class="wm-title">Alexa Crawls</span></a>
		<div style="max-height:75px;overflow:hidden;position:relative;">
	  <div style="position:absolute;top:0;left:0;width:100%;height:75px;background:linear-gradient(to bottom,rgba(255,255,255,0) 0%,rgba(255,255,255,0) 90%,rgba(255,255,255,255) 100%);"></div>
	  Starting in 1996, <a href="http://www.alexa.com/">Alexa Internet</a> has been donating their crawl data to the Internet Archive.  Flowing in every day, these data are added to the <a href="http://web.archive.org/">Wayback Machine</a> after an embargo period.
	</div>
	      </div>
      <div style="display:inline-block;vertical-align:top;width:49%;">
			<span class="c-logo" style="background-image:url(https://archive.org/services/img/alexacrawls)"></span>
		<div>Collection: <a style="color:#33f;" href="https://archive.org/details/alexacrawls" target="_new"><span class="wm-title">Alexa Crawls</span></a></div>
		<div style="max-height:75px;overflow:hidden;position:relative;">
	  <div style="position:absolute;top:0;left:0;width:100%;height:75px;background:linear-gradient(to bottom,rgba(255,255,255,0) 0%,rgba(255,255,255,0) 90%,rgba(255,255,255,255) 100%);"></div>
	  Starting in 1996, <a href="http://www.alexa.com/">Alexa Internet</a> has been donating their crawl data to the Internet Archive.  Flowing in every day, these data are added to the <a href="http://web.archive.org/">Wayback Machine</a> after an embargo period.
	</div>
	      </div>
    </div>
    </div>
    <div id="wm-capinfo-timestamps">
    <div style="background-color:#666;color:#fff;font-weight:bold;text-align:center" title="Timestamps for the elements of this page">TIMESTAMPS</div>
    <div>
      <div id="wm-capresources" style="margin:0 5px 5px 5px;max-height:250px;overflow-y:scroll !important"></div>
      <div id="wm-capresources-loading" style="text-align:left;margin:0 20px 5px 5px;display:none"><img src="/_static/images/loading.gif" alt="loading" /></div>
    </div>
    </div>
  </div></div></div></div><div id="donato" style="position:relative;width:100%;">
  <div id="donato-base">
    <iframe id="donato-if" src="https://archive.org/includes/donate.php?as_page=1&amp;platform=wb&amp;referer=http%3A//web.archive.org/web/20131231023955/http%3A//jonathan.tang.name/files/scheme_in_48/tutorial/repl.html"
	    scrolling="no" frameborder="0" style="width:100%; height:100%">
    </iframe>
  </div>
</div><script type="text/javascript">
__wm.bt(650,27,25,2,"web","http://jonathan.tang.name/files/scheme_in_48/tutorial/repl.html","20131231023955",1996,"/_static/",["/_static/css/banner-styles.css?v=bsmaklHF","/_static/css/iconochive.css?v=qtvMKcIJ"]);
  __wm.rw(1);
</script>
<!-- END WAYBACK TOOLBAR INSERT -->
<h1 align="center">Write Yourself a Scheme in 48 Hours</h1>
<h2 align="center">A Haskell Tutorial</h2>
<h3 align="center">By Jonathan Tang</h3>
<center><p><a href="/web/20131231023955/http://jonathan.tang.name/files/scheme_in_48/scheme_in_48.tgz">Download in .tar.gz format</a><br/>
<a href="/web/20131231023955/http://jonathan.tang.name/files/scheme_in_48/scheme_in_48.zip">Download in .zip format</a></p></center>
<h3>Contents</h3>
<ol>
<li><a href="overview.html">Overview</a></li>
<li><a href="firststeps.html">First Steps: Compiling and running</a></li>
<li><a href="parser.html">Parsing</a></li>
<ol>
<li><a href="parser.html#symbols">A Simple Parser</a></li>
<li><a href="parser.html#whitespace">Whitespace</a></li>
<li><a href="parser.html#primitives">Literal Numbers and Strings: Return Values</a></li>
<li><a href="parser.html#lists">Lists, Dotted Lists, and Quoted Data: Recursive Parsers</a></li>
</ol>
<li><a href="evaluator1.html">Evaluation, Part 1</a></li>
<ol>
<li><a href="evaluator1.html#show">Displaying Values: Show and Typeclasses</a></li>
<li><a href="evaluator1.html#primitiveval">Evaluating Primitive Values: Pattern Matching</a></li>
<li><a href="evaluator1.html#primitivefunc">Evaluating Primitive Functions: First-class Functions</a></li>
</ol>
<li><a href="errorcheck.html">Intermezzo: Error Checking &amp; Exceptions</a></li>
<li><a href="evaluator2.html">Evaluation, Part 2</a></li>
<ol>
<li><a href="evaluator2.html#primitives">Additional Primitives: Partial Application</a></li>
<li><a href="evaluator2.html#conditionals">Conditionals: Pattern Matching 2</a></li>
<li><a href="evaluator2.html#lists">List Primitives: car, cdr, and cons</a></li>
<li><a href="evaluator2.html#equal">Equal? and Weak Typing: Heterogenous Lists</a></li>
</ol>
<li><a href="repl.html">Building a REPL: Basic I/O</a></li>
<li><a href="variables.html">Adding Variables and Assignment: Mutable State in Haskell</a></li>
<li><a href="functions.html">Defining Scheme Functions: Closures and Environments</a></li>
<li><a href="io.html">Creating IO Primitives: File I/O</a></li>
<li><a href="stdlib.html">Towards a Standard Library: Fold and Unfold</a></li>
<li><a href="conclusion.html">Conclusion &amp; Further Resources</a></li>
</ol>
<h3>7. Building a REPL</h3>
<p>
So far, we've been content to evaluate single expressions from the command line, printing the result and exiting afterwards.  This is fine for a calculator, but isn't what most people think of as "programming".  We'd like to be able to define new functions and variables, and refer to them later.  But before we can do this, we need to build a system that can execute multiple statements without exiting the program.
</p><p>
Instead of executing a whole program at once, we're going to build a <i>read-eval-print loop</i>. This reads in expressions from the console one at a time and executes them interactively, printing the result after each expression.  Later expressions can reference variables set by earlier ones (or will be able to, after the next section), letting you build up libraries of functions.
</p><p>
First, we need to import some additional <a href="http://web.archive.org/web/20131231023955/http://www.haskell.org/onlinereport/io.html">IO functions</a>.  Add the following to the top of the program:
<pre class="tutorial">
import IO hiding (try)
</pre>
We have to hide the try function (used in the IO module for exception handling) because we use Parsec's try function. 
</p><p>
Next, we define a couple helper functions to simplify some of our IO tasks.  We'll want a function that prints out a string and immediately flushes the stream; otherwise, output might sit in output buffers and the user will never see prompts or results.
<pre class="tutorial">
flushStr :: String -&gt; IO ()
flushStr str = putStr str &gt;&gt; hFlush stdout
</pre>
Then, we create a function that prints out a prompt and reads in a line of input:
<pre class="tutorial">
readPrompt :: String -&gt; IO String
readPrompt prompt = flushStr prompt &gt;&gt; getLine
</pre>
Pull the code to parse and evaluate a string and trap the errors out of main into its own function:
<pre class="tutorial">
evalString :: String -&gt; IO String
evalString expr = return $ extractValue $ trapError (liftM show $ readExpr expr &gt;&gt;= eval) 
</pre>
And write a function that evaluates a string and prints the result:
<pre class="tutorial">
evalAndPrint :: String -&gt; IO ()
evalAndPrint expr =  evalString expr &gt;&gt;= putStrLn
</pre>
</p><p>
Now it's time to tie it all together.  We want to read input, perform a function, and print the output, all in an infinite loop.  The built-in function <a href="http://web.archive.org/web/20131231023955/http://www.haskell.org/onlinereport/standard-prelude.html#$vinteract">interact</a> <i>almost</i> does what we want, but doesn't loop.  If we used the combination <span class="inline_code">sequence . repeat . interact</span>, we'd get an infinite loop, but we wouldn't be able to break out of it.  So we need to roll our own loop:
<pre class="tutorial">
until_ :: Monad m =&gt; (a -&gt; Bool) -&gt; m a -&gt; (a -&gt; m ()) -&gt; m ()
until_ pred prompt action = do 
  result &lt;- prompt
  if pred result 
     then return ()
     else action result &gt;&gt; until_ pred prompt action
</pre>
The underscore after the name is a typical naming convention in Haskell for monadic functions that repeat but do not return a value.  until_ takes a predicate that signals when to stop, an action to perform before the test, and a function-returning-an-action to do to the input.  Each of the latter two is generalized over <i>any</i> monad, not just IO.  That's why we write their types using the type variable "m", and include the type constraint "Monad m =&gt;".  
</p><p>
Note also that we can write recursive actions just as we write recursive functions.
</p><p>
Now that we have all the machinery in place, we can write our REPL easily:
<pre class="tutorial">
runRepl :: IO ()
runRepl = until_ (== "quit") (readPrompt "Lisp&gt;&gt;&gt; ") evalAndPrint
</pre>
And change our main function so it either executes a single expression, or enters the REPL and continues evaluating expressions until we type "quit":
<pre class="tutorial">
main :: IO ()
main = do args &lt;- getArgs
          case length args of
              0 -&gt; runRepl
              1 -&gt; evalAndPrint $ args !! 0
              otherwise -&gt; putStrLn "Program takes only 0 or 1 argument"
</pre>
Compile and run the program, and try it out:
<pre class="console">
debian:/home/jdtang/haskell_tutorial/code# ghc -package parsec -fglasgow-exts -o lisp <a href="/web/20131231023955/http://jonathan.tang.name/files/scheme_in_48/code/listing7.hs">listing7.hs</a>
debian:/home/jdtang/haskell_tutorial/code# ./lisp
Lisp&gt;&gt;&gt; (+ 2 3)
5
Lisp&gt;&gt;&gt; (cons this '())
Unrecognized special form: this
Lisp&gt;&gt;&gt; (cons 2 3)
(2 . 3)
Lisp&gt;&gt;&gt; (cons 'this '())
(this)
Lisp&gt;&gt;&gt; quit
debian:/home/jdtang/haskell_tutorial/code#
</pre>
<div align="right">
<a href="variables.html">Next: Adding Variables and Assignment</a>
</div>
</body>
</html>
<!--
     FILE ARCHIVED ON 02:39:55 Dec 31, 2013 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 09:43:40 Jan 11, 2021.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
<!--
playback timings (ms):
  captures_list: 626.846
  exclusion.robots: 0.22
  exclusion.robots.policy: 0.203
  RedisCDXSource: 5.75
  esindex: 0.01
  LoadShardBlock: 597.047 (3)
  PetaboxLoader3.datanode: 467.688 (7)
  PetaboxLoader3.resolve: 146.991 (3)
  CDXLines.iter: 18.345 (2)
  load_resource: 53.103
-->